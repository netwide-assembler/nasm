# Generated automatically from Makefile.in by configure.
# $Id$
#
# Auto-configuring Makefile for the Netwide Assembler.
#
# The Netwide Assembler is copyright (C) 1996 Simon Tatham and
# Julian Hall. All rights reserved. The software is
# redistributable under the licence given in the file "Licence"
# distributed in the NASM archive.

srcdir		= .
prefix		= /usr/local
exec_prefix	= ${prefix}
bindir		= ${exec_prefix}/bin
mandir		= ${prefix}/man

CC		= gcc
CFLAGS		= -s -Zomf -O2 -fomit-frame-pointer -Wall -pedantic \
		  -I$(srcdir) -I. -DTASM_COMPAT
LDFLAGS		= -s -Zomf -Zexe -Zcrtdll
LIBS		= -lgcc

INSTALL		= ./install-sh -c
INSTALL_PROGRAM	= ${INSTALL}
INSTALL_DATA	= ${INSTALL} -m 644

NROFF		= echo
PERL            = perl

.SUFFIXES: .c .i .s .o .1 .man

.PHONY: all doc rdf install clean distclean cleaner spotless install_rdf
.PHONY: install_doc everything install_everything

.c.o:
	$(CC) -c $(CFLAGS) -o $@ $<

.c.s:
	$(CC) -S $(CFLAGS) -o $@ $<

.c.i:
	$(CC) -E $(CFLAGS) -o $@ $<

.1.man:
	$(NROFF) -man $< > $@

NASM = nasm.o nasmlib.o float.o insnsa.o assemble.o labels.o \
       parser.o outform.o output/outbin.o output/outaout.o output/outcoff.o output/outelf.o \
       output/outobj.o output/outas86.o output/outrdf.o output/outrdf2.o output/outdbg.o output/outieee.o \
       preproc.o listing.o eval.o

NDISASM = ndisasm.o disasm.o sync.o nasmlib.o insnsd.o

all: nasm ndisasm nasm.man ndisasm.man
	$(MAKE) -C rdoff -f Makefile.emx all

nasm: $(NASM)
	$(CC) $(LDFLAGS) -o nasm $(NASM) $(LIBS)

ndisasm: $(NDISASM)
	$(CC) $(LDFLAGS) -o ndisasm $(NDISASM) $(LIBS)

# These source files are automagically generated from a single
# instruction-table file by a Perl script. They're distributed,
# though, so it isn't necessary to have Perl just to recompile NASM
# from the distribution.

insnsa.c: insns.dat insns.pl
	$(PERL) $(srcdir)/insns.pl -a $(srcdir)/insns.dat
insnsd.c: insns.dat insns.pl
	$(PERL) $(srcdir)/insns.pl -d $(srcdir)/insns.dat
insnsi.h: insns.dat insns.pl
	$(PERL) $(srcdir)/insns.pl -i $(srcdir)/insns.dat
insnsn.c: insns.dat insns.pl
	$(PERL) $(srcdir)/insns.pl -n $(srcdir)/insns.dat

# These files contains all the standard macros that are derived from
# the version number.
version.h: version version.pl
	$(PERL) $(srcdir)/version.pl h < $(srcdir)/version > version.h

version.mac: version version.pl
	$(PERL) $(srcdir)/version.pl mac < $(srcdir)/version > version.mac

# This source file is generated from the standard macros file
# `standard.mac' by another Perl script. Again, it's part of the
# standard distribution.

macros.c: standard.mac macros.pl version.mac
	$(PERL) $(srcdir)/macros.pl $(srcdir)/standard.mac version.mac

# These source files are generated from regs.dat by yet another
# perl script.
regs.c: regs.dat regs.pl
	$(PERL) $(srcdir)/regs.pl c $(srcdir)/regs.dat > regs.c
regflags.c: regs.dat regs.pl
	$(PERL) $(srcdir)/regs.pl fc $(srcdir)/regs.dat > regflags.c
regdis.c: regs.dat regs.pl
	$(PERL) $(srcdir)/regs.pl dc $(srcdir)/regs.dat > regdis.c
regvals.c: regs.dat regs.pl
	$(PERL) $(srcdir)/regs.pl vc $(srcdir)/regs.dat > regvals.c
regs.h: regs.dat regs.pl
	$(PERL) $(srcdir)/regs.pl h $(srcdir)/regs.dat > regs.h

install: nasm ndisasm
	$(INSTALL_PROGRAM) nasm $(INSTALLROOT)$(bindir)/nasm
	$(INSTALL_PROGRAM) ndisasm $(INSTALLROOT)$(bindir)/ndisasm
	$(INSTALL_DATA) $(srcdir)/nasm.1 $(INSTALLROOT)$(mandir)/man1/nasm.1
	$(INSTALL_DATA) $(srcdir)/ndisasm.1 $(INSTALLROOT)$(mandir)/man1/ndisasm.1

clean:
	rm -f *.o *.s *.i nasm ndisasm
	cd rdoff && $(MAKE) clean

distclean: clean
	rm -f config.* Makefile *~ *.bak *.lst *.bin
	cd rdoff && $(MAKE) distclean

cleaner: clean
	rm -f insnsa.c insnsd.c insnsi.h insnsn.c macros.c *.man
	cd doc && $(MAKE) clean

spotless: distclean cleaner

rdf:
	cd rdoff && $(MAKE)

rdf_install install_rdf:
	cd rdoff && $(MAKE) install

doc:
	cd doc && $(MAKE) all

doc_install install_doc:
	cd doc && $(MAKE) install

everything: all doc rdf

install_everything: everything install install_doc install_rdf

#-- Magic hints to mkdep.pl --#
# @object-ending: ".o"
# @path-separator: "/"
#-- Everything below is generated by mkdep.pl - do not edit --#
assemble.o: assemble.c insns.h assemble.h regvals.c nasm.h regs.h insnsi.h \
 nasmlib.h version.h
disasm.o: disasm.c insns.h regs.c sync.h names.c nasm.h disasm.h regs.h \
 insnsn.c insnsi.h version.h regdis.c
eval.o: eval.c nasm.h regs.h labels.h insnsi.h nasmlib.h version.h eval.h
float.o: float.c nasm.h regs.h insnsi.h version.h
insnsa.o: insnsa.c insns.h nasm.h regs.h insnsi.h version.h
insnsd.o: insnsd.c insns.h nasm.h regs.h insnsi.h version.h
insnsn.o: insnsn.c
labels.o: labels.c nasm.h regs.h insnsi.h nasmlib.h version.h
listing.o: listing.c listing.h nasm.h regs.h insnsi.h nasmlib.h version.h
macros.o: macros.c
names.o: names.c regs.c insnsn.c
nasm.o: nasm.c listing.h preproc.h insns.h outform.h assemble.h parser.h \
 nasm.h regs.h labels.h insnsi.h nasmlib.h version.h eval.h
nasmlib.o: nasmlib.c regs.c names.c nasm.h regs.h insnsn.c insnsi.h \
 nasmlib.h version.h
ndisasm.o: ndisasm.c insns.h sync.h nasm.h disasm.h regs.h insnsi.h \
 nasmlib.h version.h
outform.o: outform.c outform.h nasm.h regs.h insnsi.h version.h
output/outaout.o: output/outaout.c outform.h nasm.h regs.h insnsi.h \
 nasmlib.h version.h
output/outas86.o: output/outas86.c outform.h nasm.h regs.h insnsi.h \
 nasmlib.h version.h
output/outbin.o: output/outbin.c outform.h nasm.h regs.h insnsi.h nasmlib.h \
 version.h
output/outcoff.o: output/outcoff.c outform.h nasm.h regs.h insnsi.h \
 nasmlib.h version.h
output/outdbg.o: output/outdbg.c outform.h nasm.h regs.h insnsi.h nasmlib.h \
 version.h
output/outelf.o: output/outelf.c outform.h nasm.h regs.h insnsi.h nasmlib.h \
 version.h
output/outieee.o: output/outieee.c outform.h nasm.h regs.h insnsi.h \
 nasmlib.h version.h
output/outobj.o: output/outobj.c outform.h nasm.h regs.h insnsi.h nasmlib.h \
 version.h
output/outrdf.o: output/outrdf.c outform.h nasm.h regs.h insnsi.h nasmlib.h \
 version.h
output/outrdf2.o: output/outrdf2.c outform.h nasm.h regs.h insnsi.h \
 nasmlib.h version.h
parser.o: parser.c parser.h nasm.h regs.h insnsi.h regflags.c float.h \
 nasmlib.h version.h
preproc.o: preproc.c nasm.h macros.c regs.h insnsi.h nasmlib.h version.h
regdis.o: regdis.c
regflags.o: regflags.c
regs.o: regs.c
regvals.o: regvals.c
sync.o: sync.c sync.h
